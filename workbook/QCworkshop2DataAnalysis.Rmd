---
title:  "Generalised Linear Models for Poisson distributed data."
author: "Emma Rand"
output:
  html_document:
    toc: true
    depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: yeti
  word_document: default
---
![](../pics/58I.png)


# Introduction

## Aims
In the second of three related workshops we will learn to apply and interpret the glm() function to poisson (count) response data.

## Objectives 
By actively following the first lecture, working through workbook examples during the workshop workshop and any completing follow-up independent study the successful student will be able to:

* Explain the link between the general linear models and the generalised linear model
* Recognise where a generalised linear model for a poisson distributed response would be appropriate and apply `glm()`
* Determine which effects are significant using using `summary()` and `anova()`

You can optionally stretch yourself by asking for more in-depth explanations about the meaning of the estimates, and the direction and magnitude of the effects or creating figures to go with your analyses. 

# Prior Independent Learning


# Workbook

## About the Workbook

The workbook for this session is divided in to 2 sections. 

**You are not expected do all of the workbook examples**

Choose **one** from each section that best matches your biological interests. For each example you choose, you should:

* read in the data file, check you know the structure and can identify the response and explanatory variables
* build a model with glm() using examples on the slides
* examine the model with summary() and anova()
* interpret the results

Optional Extension: Practice your plotting skills.


## Section 1

**Choose one of:**

### Parkinson's disease 

This example examines the progression of Parkinson's disease in flies with a Parkinson's disease-associated mutation.
The effect of age on locomoter ability of flies with a Parkinson's disease-associated mutation was determined by using a climbing assay. Ten flies of each tested age were placed in 3 replicate vials and the number able to climb to a set height within set time was recorded.
The data in are [park.txt](../data/park.txt) and the ages are given in days. Each row is a vial. Can you predict the number of mutant flies able to climb by their age?  

```{r echo=FALSE,results="hide",warning=FALSE,message=FALSE,eval=FALSE}
#============== WORKBOOK EXAMPLE ==============#
# Disease progression in Parkinson's disease-associated mutants
# Read in file. the response is counts so poisson is appropriate
park <- read.table("../data/park.txt",header=T)
str(park)
mod<-glm(flies~age, family="poisson", data=park)
summary(mod)
exp(mod$coef)
anova(mod,test="Chisq")
# interpret the results
 #6.9 flies are expected to be able to climb at age 0 (the intercept). For each day they age, the number that can climb is reduced by a factor of 0.96. This is significant
```

----------------------------------------

### Protein kinase

This example concerns the effect of a Mitogen-activated protein (MAP) Kinase Inhibitor on the number of nuclei in neurons
The importance of Mitogen-activated protein kinases in regulating cell division led researchers to hypothesise that MAPK inhibition might effect cytokinesis following mitosis. They treated samples of neurons with PD089059, a MAPK inhibitor, at various concentrations (1 to 15 in arbitrary units) and recorded the number of nuclei per cell.
The data in are [kinase.txt](../data/kinase.txt). Each row is a cell. Can you predict the number of nuclei by PD089059 concentration?  

```{r echo=FALSE,results="hide",warning=FALSE,message=FALSE,eval=FALSE}
#============== WORKBOOK EXAMPLE ==============#
# The effect of a MAPK Kinase Inhibitor on the number of nuclei in neurons
# Read in file. the response is counts so poisson is appropriate
kinase <- read.table("../data/kinase.txt",header=T)
str(kinase)
mod<-glm(nuclei~pdconc, family="poisson", data=kinase)
summary(mod)
exp(mod$coef)
anova(mod,test="Chisq")
# interpret the results
 #1.008 nuclei are expected PDconc = 0 (the intercept). For each unit of concentration increase the number of nuclei increases by a factor of 1.09. This is significant
```

----------------------------------------


## Section 2

**Choose one of:**

### Number of mutations

This example is about how the number of mutations in a hypermutable tetranucleotide marker is affected by a person's age and whether of not they have cancer.
The number of mutations in the hypermutable tetranucleotide marker D7S1482 were analysed in buccal specimens from 30 head and neck carcinoma cases and 43 controls. Also recorded was the subject's age (in years). The goal of analysis was to determine whether age and cancer status could predict the number of mutations. The data are in  [mutation.txt](../data/mutation.txt) and comprise the following variables:

* mut : the number of mutations
* age : a continuous measure of the subject's age to the nearest 0.1 of a degree.
* cat : a factor with two levels, "control" and "tumour"


```{r echo=FALSE,results="hide",warning=FALSE,message=FALSE}
#============== WORKBOOK EXAMPLE ==============#
#The effect of age and cancer status on the number of mutations in a hypermutable tetranucleotide marker
#Read in the data file 
mutation <- read.table("../data/mutation.txt", header = TRUE)
str(mutation)
#build and examine model. the repsonse is a count so it is poisson
mod<-glm(mut~age*cat, family="poisson", data=mutation)
summary(mod)
anova(mod,test="Chisq")


# There is a significant effect of age on the number of mutations with the number of mutations increasing with age
#The control subjects had signifcantly fewer mutation than tumour subjects 
#the interaction was signifcant: The effect of age is greater for tumour subjects than control subjects 


```
----------------------------------------

### Birds catching insects

This example considers the effects of age, habitat type and group size on the ability of birds to catch insects.
The number of insect prey individuals of a particular bird species manages to collect varies. In an effort to understand this variation, researchers recorded the number of prey an individual caught, its age, whether it was foraging in open or closed habitat and how it spent the majority of it's time (as a single individual, in a pair or in a group of many). The data are in [prey.txt](../data/prey.txt) and comprise following variables:

* prey    : the number of insect prey items caught
* age     : the individual's age in years (to one tenth of a year) 
* group   : how the individual spent the majority of its time; a factor with three levels "many", "pair", "single"
* habitat : a factor with 2 levels "closed", "open"

The goal of analysis was to determine if the number of prey items caught could be explained by age, habitat and group.

```{r echo=FALSE,results="hide",warning=FALSE,message=FALSE,eval=FALSE}
#============== WORKBOOK EXAMPLE ==============#
#The effect of age, habitat and group size on the ability of birds to catch insects
#read in data
prey <- read.table("../data/prey.txt",header=T)
str(prey)
#build and examine model. the repsonse is counts so it is poisson
   mod <- glm(prey ~ age * group * habitat, family = poisson, data=prey)
   summary(mod)
   anova(mod,test="Chisq")
# interpret the results
# there is a signifcant effect of age with old birds catching more insects. there is a signifcant effect of group size with individuals spend time with many others catching the most insects and singles catching the fewest. there is also an interaction between group size and age. it is hard to tease out in what waht way from the summary table but it looks like the effect of age is smaller for singles.
   #in reality we would likely simplify the model starting with removing the three-way interaction 
```

# The Rmd file

Suggested analyses and interpretation for Workbook examples are marked:

`#============== WORKBOOK EXAMPLE ==============#` 


[Rmd file](QCworkshop2DataAnalysis.Rmd)



![](../pics/58Iend.png)


